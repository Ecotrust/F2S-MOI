{% load static compress wagtailcore_tags %}
<body>
<div class="map-tooltip tooltip-{{ data.id }}"></div>
<script>

generateMap{{ data.id }}();

function generateMap{{ data.id }}() {
    var svg = d3.select(".viz-{{ data.id }}")
        .append("div")
        .classed("svg-container", true)
        .append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 700 600")
        .classed("svg-content-responsive", true);

    var tooltip = d3.select("div.tooltip-{{ data.id }}");


    d3.json("{% static 'js/school_district_topo.json' %}", function(error, or) {
        var colorArrays = [
            //environment
            '#ba2226',
            //education
            '#185377',
            //health
            '#f6ab1b',
            //economy
            '#83b841'
        ];

        function sectorColor() {
            switch('{{ request.path }}') {
                case '/environment/':
                    sector = colorArrays[0];
                    break;
                case '/education/':
                    sector = colorArrays[1];
                    break;
                case '/health/':
                    sector = colorArrays[2];
                    break;
                case '/economy/':
                    sector = colorArrays[3];
                    break;
            }
            return sector
        }

        var districts = topojson.feature(or, or.objects.school_district_geo).features,
            ids = {{ data.data_values }}

        var projection = d3.geo.mercator()
            .center([-118.6, 44.3])
            .scale(4000)

        var path = d3.geo.path()
            .projection(projection)

        svg.append("g")
            .attr("class", "school_district_geo")
            .selectAll("path")
                .data(districts)  
                .enter()
                .append("path")
                .attr("d", path)

                .style("fill", function(d) { 
                    if (ids.indexOf(d.properties.ET_UID) > -1) { return sectorColor() }
                })

                .on('mouseover', function(d) {
                    d3.select(this).classed('hover', true)

                    tooltip
                        .style('visibility', 'visible')
                        .html(d.properties.SCHOOL_DIS);
                })

                .on('mouseout', function() {
                    tooltip.style('visibility', 'hidden');
                    d3.select(this).classed('hover', false)
                });
    });
}

</script>
</body>